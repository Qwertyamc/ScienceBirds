class Level{constructor(s){this.JSONData=s,this.boxes=[],this.boundaries=[],this.birds=[],this.pigs=[],this.surface,this.floorPosition=700,this.birdsThrown,this.pigNumber,this.bkgSky=loadImage("assets/sky.png"),this.bkgFloor=loadImage("assets/floor.png"),this.bach=loadImage("assets/back-arrow.png"),this.box=loadImage("assets/WoodBox.png"),this.normalBird=loadImage("assets/BasicBird.png"),this.bigBird=loadImage("assets/BigBird.png"),this.yellowBird=loadImage("assets/FastBird.png"),this.blueBird=loadImage("assets/Tribird.png"),this.randomBird=loadImage("assets/RandomBird.png"),this.bombBird=loadImage("assets/BombBird.png"),this.sling_back=loadImage("assets/slingshotBack.png"),this.sling_front=loadImage("assets/slingshotFront.png"),this.win_screen=loadImage("assets/win-screen.png"),this.lose_screen=loadImage("assets/lose-screen.png"),this.playState,this.bird,this.explosionCenter,this.exploded,this.explosionGif=loadImage("assets/explosion.gif"),this.points}setup(){this.JSONData.boxes.forEach((s=>{switch(s.type){case"fusta":this.boxes.push(new Fusta(s.position[0],s.position[1],s.size[0],s.size[1]));break;case"gel":this.boxes.push(new Gel(s.position[0],s.position[1],s.size[0],s.size[1]));break;case"metall":this.boxes.push(new Metall(s.position[0],s.position[1],s.size[0],s.size[1]));break;case"lava":this.boxes.push(new Lava(s.position[0],s.position[1],s.size[0],s.size[1]));break;case"bedrock":this.boxes.push(new Bedrock(s.position[0],s.position[1],s.size[0],s.size[1]));break;case"tnt":this.boxes.push(new Tnt(s.position[0],s.position[1],s.size[0],s.size[1]))}})),this.JSONData.pigs.forEach((s=>{switch(s.type){case"normal":this.pigs.push(new NormalPig(s.position[0],s.position[1],s.radius));break;case"hat":this.pigs.push(new HatPig(s.position[0],s.position[1],s.radius))}})),this.JSONData.boundaries.forEach((s=>{this.boundaries.push(new Boundary(s.position[0],s.position[1],s.size[0],s.size[1]))})),this.playState=0,this.bird=0,this.birdsThrown=0,this.pigNumber=this.pigs.length,this.points=5,this.exploded=!1}draw(){switch(this.drawBackground(),this.playState){case 0:this.points>1?fill(color(128,128,128)):fill(color(255,0,0)),textSize(64),text("Current points: "+this.points,width/2-200,128);for(let s=0;s<this.boundaries.length;s++)this.boundaries[s].display();for(let s=0;s<this.pigs.length;s++)this.pigs[s].done()?this.pigs.splice(s,1):this.pigs[s].displayAsset();this.pigNumber!=this.pigs.length&&(this.points+=3,this.pigNumber=this.pigs.length);for(let s=0;s<this.boxes.length;s++)this.boxes[s].done()?this.boxes.splice(s,1):this.boxes[s].displayAsset();for(let s=0;s<this.birds.length;s++)this.birds[s].done()?this.birds.splice(s,1):this.birds[s].displayAsset();break;case 1:textSize(100),fill(color(255,255,255)),image(this.win_screen,446,235),text("Total points: "+this.points,525,height/2+175);break;case 2:textSize(128),image(this.lose_screen,446,235)}this.pigNumber<1?this.playState=1:this.points<1&&setTimeout((()=>{this.points<1&&(this.playState=2)}),5e3)}drawBackground(){image(this.bkgSky,0,0),image(this.bkgFloor,0,0),image(this.bach,0,0,150,150),image(this.sling_back,200,465),image(this.sling_front,172,463),fill(color(255,255,255,128)),rectMode(CORNERS),rect(30+175*this.bird,height-145,170+175*this.bird,height-5),image(this.box,25,height-150,150,150),image(this.normalBird,55,height-120,90,90),image(this.box,200,height-150,150,150),image(this.bigBird,230,height-120,90,90),image(this.box,375,height-150,150,150),image(this.yellowBird,405,height-120,90,90),image(this.box,550,height-150,150,150),image(this.blueBird,580,height-120,90,90),image(this.box,725,height-150,150,150),image(this.randomBird,755,height-120,90,90),image(this.box,900,height-150,150,150),image(this.bombBird,930,height-120,90,90);let s=200;this.exploded&&image(this.explosionGif,this.explosionCenter.x-s,this.explosionCenter.y-s,400,400)}createBird(s){if(this.points>0){let i;switch(this.bird){case 0:i=new NormalBird(mouseX,mouseY);break;case 1:i=new BigBird(mouseX,mouseY);break;case 2:i=new YellowBird(mouseX,mouseY);break;case 3:i=new BlueBird(mouseX,mouseY);break;case 4:i=new RandomBird(mouseX,mouseY);break;case 5:i=new BombBird(mouseX,mouseY)}i.setVelocity(s.mult(-1)),this.birds.push(i),this.points--}}birdAbility(){this.birds.forEach((s=>{s.done()||s.abilityUsed||(s.birdAbility(),s.abilityUsed=!0)}))}explosion(s,i){let e;this.explosionCenter=scaleToPixels(s),this.exploded=!0,setTimeout((()=>{this.exploded=!1}),500),this.birds.forEach((t=>{e=t.body.GetPosition(),abs(this.vecMagnitude(s)-this.vecMagnitude(e))<=i&&t.applyBlastImpulse(s,t.body.GetPosition(),30)})),this.boxes.forEach((t=>{e=t.body.GetPosition();let o=abs(this.vecMagnitude(s)-this.vecMagnitude(e));console.log(o),o<=i&&(t.applyBlastImpulse(s,t.body.GetPosition(),30),t.damage())})),this.pigs.forEach((t=>{e=t.body.GetPosition(),abs(this.vecMagnitude(s)-this.vecMagnitude(e))<=i&&(t.applyBlastImpulse(s,t.body.GetPosition(),30),t.damage())}))}vecMagnitude(s){return sqrt(pow(s.x,2)+pow(s.y,2))}resetLevel(){this.boxes.forEach((s=>s.destroyNow())),this.boundaries.forEach((s=>s.destroyNow())),this.birds.forEach((s=>s.destroyNow())),this.pigs.forEach((s=>s.destroyNow())),this.boxes=[],this.boundaries=[],this.birds=[],this.pigs=[]}}